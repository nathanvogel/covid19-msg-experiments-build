{"version":3,"sources":["loadTexture.ts","shaderpen.ts","ImUsBackground.ts","App.tsx","index.tsx"],"names":["loadTexture","gl","url","texture","createTexture","bindTexture","TEXTURE_2D","internalFormat","RGBA","srcFormat","srcType","UNSIGNED_BYTE","pixel","Uint8Array","texImage2D","image","Image","onload","isPowerOf2","width","height","generateMipmap","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","src","value","debounce","require","ShaderPen","shaderString","noRender","arg_options","canvasScale","didDOM","options","maxDomNodeCount","textures","midiBindings","midiLogs","uniforms","iResolution","type","window","innerWidth","this","innerHeight","scaledResolutionTarget","iTime","iTimeDelta","iFrame","iMouse","DOM","arraySize","DOMColors","domList","midiList","debouncedLogMIDIState","logMIDIState","canvas","vertexShader","fragmentShader","program","vertices","mousedown","lastTime","fpsFilterStrength","frameTime","lastLoop","Date","now","thisLoop","measureFPS","thisFrameTime","changeCanvasScale","scale","console","log","style","transform","_bind","Object","assign","Array","fill","additionalUniforms","addUniforms","setupMIDIBindings","isCanvasProvided","document","createElement","position","zIndex","left","top","transformOrigin","body","append","getContext","ensureCanvasSize","clearColor","createShader","VERTEX_SHADER","shaderSource","compileShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","Float32Array","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","useProgram","programPosition","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","keys","forEach","key","i","location","getUniformLocation","setupTextures","reportErrors","addEventListener","mouseDown","mouseMove","mouseUp","render","methods","method","bind","e","clientX","clientY","name","sizeName","newUniforms","bindings","coords","colors","length","rect","element","getBoundingClientRect","right","bottom","color","flags","b","isArray","messageKey","bindingOptions","variableName","defaultValue","initial","midiMessage","data","from","to","low1","high1","low2","high2","remap","indexOf","toFixed","timestamp","delta","updateDOMBindings","clear","COLOR_BUFFER_BIT","t","activeTexture","TEXTURE0","uniform1i","match","drawArrays","TRIANGLES","requestAnimationFrame","viewport","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","getProgramParameter","LINK_STATUS","getProgramInfoLog","ImUsBackground","pen","controlledUniforms","noise1Speed","noise1Motion","noise1Scale","noise2Speed","noise2Motion","noise2Scale","blurSize","padSize","noise2Mix","setMessages","messages","map","message","draft","setDOMBindings","Shaderpen","toString","showDatGui","gui","dat","GUI","add","App","useEffect","background","getElementById","elements","getElementsByClassName","push","Math","random","classList","contains","id","contentEditable","suppressContentEditableWarning","className","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.8562c513.chunk.js","sourcesContent":["// From: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL\r\n\r\nexport function loadTexture(gl: WebGLRenderingContext, url: string) {\r\n  const texture = gl.createTexture();\r\n  gl.bindTexture(gl.TEXTURE_2D, texture);\r\n\r\n  // Because images have to be download over the internet\r\n  // they might take a moment until they are ready.\r\n  // Until then put a single pixel in the texture so we can\r\n  // use it immediately. When the image has finished downloading\r\n  // we'll update the texture with the contents of the image.\r\n  const level = 0;\r\n  const internalFormat = gl.RGBA;\r\n  const width = 1;\r\n  const height = 1;\r\n  const border = 0;\r\n  const srcFormat = gl.RGBA;\r\n  const srcType = gl.UNSIGNED_BYTE;\r\n  const pixel = new Uint8Array([255, 255, 255, 255]); // opaque blue\r\n  gl.texImage2D(\r\n    gl.TEXTURE_2D,\r\n    level,\r\n    internalFormat,\r\n    width,\r\n    height,\r\n    border,\r\n    srcFormat,\r\n    srcType,\r\n    pixel\r\n  );\r\n\r\n  const image = new Image();\r\n  image.onload = function () {\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texImage2D(\r\n      gl.TEXTURE_2D,\r\n      level,\r\n      internalFormat,\r\n      srcFormat,\r\n      srcType,\r\n      image\r\n    );\r\n\r\n    // WebGL1 has different requirements for power of 2 images\r\n    // vs non power of 2 images so check if the image is a\r\n    // power of 2 in both dimensions.\r\n    if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\r\n      // Yes, it's a power of 2. Generate mips.\r\n      gl.generateMipmap(gl.TEXTURE_2D);\r\n    } else {\r\n      // No, it's not a power of 2. Turn off mips and set\r\n      // wrapping to clamp to edge\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    }\r\n  };\r\n  image.src = url;\r\n\r\n  return texture;\r\n}\r\n\r\nfunction isPowerOf2(value: number) {\r\n  return (value & (value - 1)) === 0;\r\n}\r\n","import { loadTexture } from \"./loadTexture\";\r\nimport {\r\n  ShaderpenOptions,\r\n  ShaderpenDOMElement,\r\n  ShaderpenUniform,\r\n  MIDIBindingOptions,\r\n  ShaderpenUniforms,\r\n} from \"./types\";\r\n\r\nconst debounce = require(\"lodash/debounce\");\r\n\r\nfunction remap(\r\n  value: number,\r\n  low1: number,\r\n  high1: number,\r\n  low2: number,\r\n  high2: number\r\n) {\r\n  return low2 + ((high2 - low2) * (value - low1)) / (high1 - low1);\r\n}\r\n\r\nexport default class ShaderPen {\r\n  canvasScale = 1;\r\n  didDOM = 0;\r\n  options: ShaderpenOptions = {\r\n    maxDomNodeCount: 0,\r\n    textures: [],\r\n    midiBindings: [],\r\n    midiLogs: false,\r\n  };\r\n  // shadertoy built in uniforms\r\n  uniforms: { [key: string]: ShaderpenUniform } = {\r\n    iResolution: {\r\n      type: \"vec3\",\r\n      value: [\r\n        window.innerWidth * this.canvasScale,\r\n        window.innerHeight * this.canvasScale,\r\n        0,\r\n      ],\r\n    },\r\n    scaledResolutionTarget: {\r\n      type: \"vec3\",\r\n      value: [window.innerWidth, window.innerHeight, 0],\r\n    },\r\n    iTime: {\r\n      type: \"float\",\r\n      value: 0,\r\n    },\r\n    iTimeDelta: {\r\n      type: \"float\",\r\n      value: 0,\r\n    },\r\n    iFrame: {\r\n      type: \"int\",\r\n      value: 0,\r\n    },\r\n    iMouse: {\r\n      type: \"vec4\",\r\n      value: [0, 0, 0, 0],\r\n    },\r\n    DOM: { type: \"vec4\", value: [] as any, arraySize: 0 },\r\n    DOMColors: { type: \"vec4\", value: [] as any, arraySize: 0 },\r\n  };\r\n  domList: ShaderpenDOMElement[] = [];\r\n  midiList: { [key: string]: MIDIBindingOptions } = {};\r\n  debouncedLogMIDIState = debounce(this.logMIDIState, 1000);\r\n  canvas: HTMLCanvasElement;\r\n  gl: WebGLRenderingContext;\r\n  vertexShader: WebGLShader;\r\n  fragmentShader: WebGLShader;\r\n  program: WebGLProgram;\r\n  vertices: Float32Array;\r\n  mousedown = false;\r\n  lastTime = 0;\r\n  fpsFilterStrength = 20;\r\n  frameTime = 0;\r\n  lastLoop = Date.now();\r\n  thisLoop = Date.now();\r\n\r\n  constructor(\r\n    shaderString: string,\r\n    noRender: \"NO_RENDER\" | undefined,\r\n    arg_options: ShaderpenOptions\r\n  ) {\r\n    // bind contexts\r\n    this._bind(\r\n      \"mouseDown\",\r\n      \"mouseMove\",\r\n      \"mouseUp\",\r\n      \"render\",\r\n      \"setupMIDIBindings\",\r\n      \"onMIDIMessage\",\r\n      \"logMIDIState\",\r\n      \"setDOMBindings\",\r\n      \"updateDOMBindings\",\r\n      \"setupTextures\",\r\n      \"measureFPS\",\r\n      \"changeCanvasScale\",\r\n      \"ensureCanvasSize\",\r\n      \"addUniforms\"\r\n    );\r\n\r\n    Object.assign(this.options, arg_options);\r\n    const options = this.options;\r\n    // shadertoy differences\r\n    /*\r\n    const ioTest = /\\(\\s*out\\s+vec4\\s+(\\S+)\\s*,\\s*in\\s+vec2\\s+(\\S+)\\s*\\)/;\r\n    const io = shaderString.match(ioTest);\r\n    shaderString = shaderString.replace(\"mainImage\", \"main\");\r\n    shaderString = shaderString.replace(ioTest, \"()\");\r\n    */\r\n\r\n    /**\r\n     * Apparently, even small vec2 and vec3 get converted to vec4\r\n     * under the hood. So let's compress all this together.\r\n     * xStart, yStart, xEnd, yEnd\r\n     */\r\n    this.uniforms.DOM = {\r\n      type: \"vec4\",\r\n      value: new Array(this.options.maxDomNodeCount * 4).fill(0),\r\n      arraySize: this.options.maxDomNodeCount,\r\n    };\r\n    // r, g, b, flags\r\n    this.uniforms.DOMColors = {\r\n      type: \"vec4\",\r\n      value: new Array(this.options.maxDomNodeCount * 4).fill(0),\r\n      arraySize: this.options.maxDomNodeCount,\r\n    };\r\n    if (options.additionalUniforms)\r\n      this.addUniforms(options.additionalUniforms);\r\n\r\n    /*\r\n    // create default string values\r\n    shaderString =\r\n      (io\r\n        ? `#define ${io[1]} gl_FragColor\\n#define ${io[2]} gl_FragCoord.xy\\n`\r\n        : \"\") + shaderString;\r\n    shaderString =\r\n      `const int DOMCount = ${this.options.maxDomNodeCount};\\n` + shaderString;\r\n    shaderString =\r\n      Object.keys(uniforms)\r\n        .map((key) => ({\r\n          name: key,\r\n          type: uniforms[key].type,\r\n          arraySize: uniforms[key].arraySize,\r\n        }))\r\n        .reduce(\r\n          (a, uniform) =>\r\n            a +\r\n            `uniform ${uniform.type} ${uniform.name}${\r\n              typeof uniform.arraySize === \"number\"\r\n                ? `[${uniform.arraySize}]`\r\n                : \"\"\r\n            };\\n`,\r\n          \"\"\r\n        ) + shaderString;\r\n    shaderString = \"precision highp float;\\n\" + shaderString;\r\n    */\r\n\r\n    this.setupMIDIBindings();\r\n\r\n    // create, position, and add canvas\r\n    const isCanvasProvided = options && options.canvas;\r\n    const canvas = (this.canvas = (isCanvasProvided\r\n      ? options.canvas\r\n      : document.createElement(\"canvas\")) as HTMLCanvasElement);\r\n    /* So that it appears under the root */\r\n    /* https://stackoverflow.com/questions/5218927/z-index-not-working-with-fixed-positioning */\r\n    canvas.style.position = \"fixed\";\r\n    canvas.style.zIndex = \"-1\";\r\n    canvas.style.left = \"0px\";\r\n    canvas.style.top = \"0px\";\r\n    canvas.style.width = 100 * this.canvasScale + \"%\";\r\n    canvas.style.height = 100 * this.canvasScale + \"%\";\r\n    canvas.style.transformOrigin = \"top left\";\r\n    canvas.style.transform = `scale(${1 / this.canvasScale})`;\r\n    // and we'll resize it juste after getting the gl context.\r\n    if (!isCanvasProvided) {\r\n      document.body.append(canvas);\r\n    }\r\n\r\n    // get webgl context and set clearColor\r\n    const gl = (this.gl = canvas.getContext(\"webgl\") as WebGLRenderingContext);\r\n    this.ensureCanvasSize();\r\n    gl.clearColor(0.5, 0.5, 0.5, 1.0);\r\n\r\n    // compile basic vertex shader to make rect fill screen\r\n    const vertexShader = (this.vertexShader = gl.createShader(\r\n      gl.VERTEX_SHADER\r\n    ) as WebGLShader);\r\n    gl.shaderSource(\r\n      vertexShader,\r\n      `\r\n      attribute vec2 position;\r\n      void main() {\r\n      gl_Position = vec4(position, 0.0, 1.0);\r\n      }\r\n    `\r\n    );\r\n    gl.compileShader(vertexShader);\r\n\r\n    // compile fragment shader from string passed in\r\n    const fragmentShader = (this.fragmentShader = gl.createShader(\r\n      gl.FRAGMENT_SHADER\r\n    ) as WebGLShader);\r\n    gl.shaderSource(fragmentShader, shaderString);\r\n    gl.compileShader(fragmentShader);\r\n\r\n    // make program from shaders\r\n    const program = (this.program = gl.createProgram() as WebGLProgram);\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n\r\n    // vertices for basic rectangle to fill screen\r\n    const vertices = (this.vertices = new Float32Array([\r\n      -1,\r\n      1,\r\n      1,\r\n      1,\r\n      1,\r\n      -1,\r\n      -1,\r\n      1,\r\n      1,\r\n      -1,\r\n      -1,\r\n      -1,\r\n    ]));\r\n\r\n    const buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.useProgram(program);\r\n\r\n    const programPosition = gl.getAttribLocation(program, \"position\");\r\n    gl.enableVertexAttribArray(programPosition);\r\n    gl.vertexAttribPointer(programPosition, 2, gl.FLOAT, false, 0, 0);\r\n\r\n    // get all uniform locations from shaders\r\n    Object.keys(this.uniforms).forEach((key, i) => {\r\n      this.uniforms[key].location = gl.getUniformLocation(program, key);\r\n    });\r\n    this.setupTextures();\r\n\r\n    // report webgl errors\r\n    this.reportErrors();\r\n\r\n    // add event listeners\r\n    window.addEventListener(\"mousedown\", this.mouseDown);\r\n    window.addEventListener(\"mousemove\", this.mouseMove);\r\n    window.addEventListener(\"mouseup\", this.mouseUp);\r\n\r\n    // auto render unless otherwise specified\r\n    if (noRender !== \"NO_RENDER\") {\r\n      this.render(Date.now());\r\n    }\r\n  }\r\n\r\n  _bind(...methods: string[]) {\r\n    methods.forEach(\r\n      (method) => ((this as any)[method] = (this as any)[method].bind(this))\r\n    );\r\n  }\r\n\r\n  mouseDown(e: MouseEvent) {\r\n    this.mousedown = true;\r\n    this.uniforms.iMouse.value[2] = e.clientX;\r\n    this.uniforms.iMouse.value[3] = e.clientY;\r\n  }\r\n\r\n  mouseMove(e: MouseEvent) {\r\n    if (this.mousedown) {\r\n      this.uniforms.iMouse.value[0] = e.clientX;\r\n      this.uniforms.iMouse.value[1] = e.clientY;\r\n    }\r\n  }\r\n\r\n  mouseUp(e: MouseEvent) {\r\n    this.mousedown = false;\r\n    this.uniforms.iMouse.value[2] = 0;\r\n    this.uniforms.iMouse.value[3] = 0;\r\n  }\r\n\r\n  setupTextures() {\r\n    for (let texture of this.options.textures) {\r\n      this.uniforms[texture.name] = {\r\n        type: \"texture\",\r\n        value: loadTexture(this.gl, texture.url),\r\n        location: this.gl.getUniformLocation(this.program, texture.name),\r\n      };\r\n      if (texture.sizeName) {\r\n        this.uniforms[texture.sizeName] = {\r\n          type: \"vec2\",\r\n          value: [texture.width, texture.height],\r\n          location: this.gl.getUniformLocation(this.program, texture.sizeName),\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  addUniforms(newUniforms: ShaderpenUniforms) {\r\n    Object.assign(this.uniforms, newUniforms);\r\n  }\r\n\r\n  setDOMBindings(bindings: ShaderpenDOMElement[]) {\r\n    this.domList = bindings;\r\n    // this.updateDOMBindings();\r\n  }\r\n\r\n  updateDOMBindings() {\r\n    const coords = this.uniforms[\"DOM\"].value;\r\n    const colors = this.uniforms[\"DOMColors\"].value;\r\n    for (let i = 0; i < this.options.maxDomNodeCount; i += 1) {\r\n      if (i < this.domList.length) {\r\n        const rect = this.domList[i].element.getBoundingClientRect();\r\n        coords[i * 4 + 0] = rect.left * this.canvasScale;\r\n        coords[i * 4 + 1] = (window.innerHeight - rect.top) * this.canvasScale;\r\n        coords[i * 4 + 2] = rect.right * this.canvasScale;\r\n        coords[i * 4 + 3] =\r\n          (window.innerHeight - rect.bottom) * this.canvasScale;\r\n        colors[i * 4 + 0] = this.domList[i].color[0];\r\n        colors[i * 4 + 1] = this.domList[i].color[1];\r\n        colors[i * 4 + 2] = this.domList[i].color[2];\r\n        colors[i * 4 + 3] = this.domList[i].flags || 0;\r\n      } else {\r\n        coords[i * 4 + 0] = 0;\r\n        coords[i * 4 + 1] = 0;\r\n        coords[i * 4 + 2] = 0;\r\n        coords[i * 4 + 3] = 0;\r\n        colors[i * 4 + 0] = 0;\r\n        colors[i * 4 + 1] = 0;\r\n        colors[i * 4 + 2] = 0;\r\n        colors[i * 4 + 3] = 0;\r\n      }\r\n    }\r\n    // Object.keys(this.uniforms)\r\n    //   .filter((a) => a.indexOf(\"DOM\") === 0)\r\n    //   .map((key) => this.uniforms[key].value)\r\n    //   .forEach((v) => console.log(v));\r\n  }\r\n\r\n  setupMIDIBindings() {\r\n    // Setup the MIDI variables even if MIDI isn't suppported, so that the shader\r\n    // does not crash on other browsers and that MIDI variables have a default value.\r\n    // Reverse mapping for quick lookup\r\n    const bindings = this.options.midiBindings || [];\r\n    for (let i = 0; i < bindings.length; i += 1) {\r\n      const b = bindings[i];\r\n      if (!Array.isArray(b) || b.length < 2) {\r\n        console.log(\"Invalid MIDI command/note: \" + b);\r\n        console.log(\"It should be an array of [command, note].\");\r\n        continue;\r\n      }\r\n      // Create a uniform for each requested binding, with variable names\r\n      // MIDI1, MIDI2, etc. in the order requested by the user.\r\n      const messageKey = b[0] + \"_\" + b[1];\r\n      const bindingOptions = b.length >= 3 && b[2] ? b[2] : {};\r\n      if (typeof bindingOptions === \"number\") {\r\n        console.log(\r\n          \"Position number 2 of the MIDI binding options should be an option object.\"\r\n        );\r\n        continue;\r\n      }\r\n      bindingOptions.variableName =\r\n        bindingOptions.variableName || \"MIDI\" + (i + 1);\r\n      const defaultValue =\r\n        typeof bindingOptions.initial == \"number\" ? bindingOptions.initial : 1;\r\n      this.uniforms[bindingOptions.variableName] = {\r\n        type: \"float\",\r\n        value: defaultValue,\r\n      };\r\n      this.midiList[messageKey] = bindingOptions;\r\n    }\r\n\r\n    // Check that the user requested it\r\n    if (\r\n      !this.options ||\r\n      !this.options.midiBindings ||\r\n      this.options.midiBindings.length === 0\r\n    )\r\n      return;\r\n    // Don't expose MIDI controls in builds\r\n    // Also to avoid potential user prompt starting with Chrome 82\r\n    if (process.env.NODE_ENV !== \"development\") return;\r\n\r\n    // Check browser support\r\n    if (!(navigator as any).requestMIDIAccess) {\r\n      console.log(\"WebMIDI is not supported in this browser.\");\r\n      return;\r\n    }\r\n\r\n    const onMIDISuccess = (midiAccess: any) => {\r\n      if (this.options.midiLogs)\r\n        console.log(\"Successful MIDI setup:\", midiAccess);\r\n      for (var input of midiAccess.inputs.values()) {\r\n        input.onmidimessage = this.onMIDIMessage;\r\n      }\r\n    };\r\n\r\n    const onMIDIFailure = () => {\r\n      console.log(\"Could not setup MIDI devices.\");\r\n    };\r\n\r\n    (navigator as any).requestMIDIAccess().then(onMIDISuccess, onMIDIFailure);\r\n  }\r\n\r\n  onMIDIMessage(midiMessage: any) {\r\n    if (!this.midiList) {\r\n      console.log(\"Missing MIDI list setup.\");\r\n      return;\r\n    }\r\n    if (!midiMessage) {\r\n      console.log(\"Invalid MIDI message: \" + midiMessage);\r\n      return;\r\n    }\r\n    const messageKey = midiMessage.data[0] + \"_\" + midiMessage.data[1];\r\n    const bindingOptions = this.midiList[messageKey];\r\n    if (!bindingOptions) {\r\n      // console.log('Unbound MIDI message: ' + midiMessage.data.toString());\r\n      return;\r\n    }\r\n    if (!bindingOptions.variableName) {\r\n      return;\r\n    }\r\n\r\n    let value = midiMessage.data[2] / 127;\r\n    if (bindingOptions.from != null && bindingOptions.to != null) {\r\n      value = remap(value, 0, 1, bindingOptions.from, bindingOptions.to);\r\n    }\r\n\r\n    this.uniforms[bindingOptions.variableName].value = value;\r\n    this.debouncedLogMIDIState();\r\n  }\r\n\r\n  logMIDIState() {\r\n    if (!this.options.midiLogs) return;\r\n    console.log(\"==== Current MIDI state ====\");\r\n    for (let key in this.uniforms) {\r\n      if (key.indexOf(\"MIDI\") !== 0) continue;\r\n      console.log(key, this.uniforms[key].value.toFixed(2));\r\n    }\r\n  }\r\n\r\n  render(timestamp: number) {\r\n    const gl = this.gl;\r\n\r\n    let delta = this.lastTime ? (timestamp - this.lastTime) / 1000 : 0;\r\n    this.lastTime = timestamp;\r\n\r\n    this.uniforms.iTime.value += delta;\r\n    this.uniforms.iTimeDelta.value = delta;\r\n    this.uniforms.iFrame.value++;\r\n\r\n    this.updateDOMBindings();\r\n    this.ensureCanvasSize();\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    Object.keys(this.uniforms).forEach((key) => {\r\n      const t = this.uniforms[key].type;\r\n      if (t === \"texture\") {\r\n        // Tell WebGL we want to affect texture unit 0\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        // Bind the texture to texture unit 0\r\n        gl.bindTexture(gl.TEXTURE_2D, this.uniforms[key].value);\r\n        // Tell the shader we bound the texture to texture unit 0\r\n        gl.uniform1i(this.uniforms[key].location || null, 0);\r\n      } else {\r\n        const method = t.match(/vec/) ? `${t[3]}fv` : `1${t[0]}`;\r\n        (gl as any)[`uniform${method}`](\r\n          this.uniforms[key].location,\r\n          this.uniforms[key].value\r\n        );\r\n      }\r\n    });\r\n    this.didDOM += 1;\r\n\r\n    gl.drawArrays(gl.TRIANGLES, 0, this.vertices.length / 2);\r\n\r\n    requestAnimationFrame(this.render);\r\n    this.measureFPS();\r\n  }\r\n\r\n  measureFPS = () => {\r\n    this.thisLoop = Date.now();\r\n    const thisFrameTime = this.thisLoop - this.lastLoop;\r\n    this.frameTime += (thisFrameTime - this.frameTime) / this.fpsFilterStrength;\r\n    this.lastLoop = this.thisLoop;\r\n    const fps = 1000 / this.frameTime;\r\n    if (fps < 28 && this.canvasScale > 0.9) {\r\n      this.changeCanvasScale(0.5);\r\n    }\r\n  };\r\n\r\n  changeCanvasScale = (scale: number) => {\r\n    console.log(`Reducing canvas scale to ${scale} to increase performance.`);\r\n    this.canvasScale = scale;\r\n    this.canvas.style.width = 100 * this.canvasScale + \"%\";\r\n    this.canvas.style.height = 100 * this.canvasScale + \"%\";\r\n    this.canvas.style.transform = `scale(${1 / this.canvasScale})`;\r\n    // Canvas size will be ensured on every frame.\r\n  };\r\n\r\n  ensureCanvasSize() {\r\n    const width = window.innerWidth * this.canvasScale;\r\n    const height = window.innerHeight * this.canvasScale;\r\n    // eslint-disable-next-line eqeqeq\r\n    if (this.canvas.width != width || this.canvas.height != height) {\r\n      this.canvas.width = this.uniforms.iResolution.value[0] = width;\r\n      this.canvas.height = this.uniforms.iResolution.value[1] = height;\r\n      this.uniforms.scaledResolutionTarget.value[0] = window.innerWidth;\r\n      this.uniforms.scaledResolutionTarget.value[1] = window.innerHeight;\r\n      this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n  }\r\n\r\n  reportErrors() {\r\n    const gl = this.gl;\r\n\r\n    if (!gl.getShaderParameter(this.vertexShader, gl.COMPILE_STATUS)) {\r\n      console.log(gl.getShaderInfoLog(this.vertexShader));\r\n    }\r\n\r\n    if (!gl.getShaderParameter(this.fragmentShader, gl.COMPILE_STATUS)) {\r\n      console.log(gl.getShaderInfoLog(this.fragmentShader));\r\n    }\r\n\r\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n      console.log(gl.getProgramInfoLog(this.program));\r\n    }\r\n  }\r\n}\r\n","import Shaderpen from \"./shaderpen\";\r\nimport {\r\n  ImUsBackgroundOptions,\r\n  ImUsBackgroundMessage,\r\n  ShaderpenUniforms,\r\n} from \"./types\";\r\nimport dat from \"dat.gui\";\r\n\r\nconst glsl = (x: TemplateStringsArray) => x.toString();\r\n\r\nclass ImUsBackground {\r\n  pen: any;\r\n  controlledUniforms: ShaderpenUniforms = {\r\n    // Draft settings\r\n    // noise1Speed: { type: \"float\", value: 1.0 },\r\n    // noise1Motion: { type: \"float\", value: -2.9 },\r\n    // noise1Scale: { type: \"float\", value: 0.3 },\r\n    // noise2Speed: { type: \"float\", value: 1.6 },\r\n    // noise2Motion: { type: \"float\", value: -4.2 },\r\n    // noise2Scale: { type: \"float\", value: 0.2 },\r\n    // blurSize: { type: \"float\", value: 2.3 },\r\n    // padSize: { type: \"float\", value: 1.4 },\r\n\r\n    // Base settings\r\n    noise1Speed: { type: \"float\", value: 0.3 },\r\n    noise1Motion: { type: \"float\", value: -2.9 },\r\n    noise1Scale: { type: \"float\", value: 0.3 },\r\n    noise2Speed: { type: \"float\", value: 0.3 },\r\n    noise2Motion: { type: \"float\", value: -4.2 },\r\n    noise2Scale: { type: \"float\", value: 0.2 },\r\n    blurSize: { type: \"float\", value: 3.6 },\r\n    padSize: { type: \"float\", value: 1.4 },\r\n\r\n    // New settings\r\n    noise2Mix: { type: \"float\", value: 1.0 },\r\n  };\r\n\r\n  constructor(options: ImUsBackgroundOptions) {\r\n    this.pen = new Shaderpen(\r\n      glsl`\r\nprecision highp float;\r\nprecision highp int;\r\n#define HIGH_PRECISION\r\n#define GAMMA_FACTOR 2\r\n#define TONE_MAPPING\r\n#pragma vscode_glsllint_stage : frag\r\n\r\nuniform vec3 iResolution;\r\nuniform vec3 scaledResolutionTarget;\r\nuniform float iTime;\r\nuniform vec4 DOMColors [20];\r\nuniform vec4 DOM [20];\r\nuniform sampler2D texture1;\r\nuniform vec2 _DitherPattern_TexelSize;\r\nuniform float noise1Speed;\r\nuniform float noise2Speed;\r\nuniform float noise1Motion;\r\nuniform float noise2Motion;\r\nuniform float noise1Scale;\r\nuniform float noise2Scale;\r\nuniform float blurSize;\r\nuniform float padSize;\r\nuniform float noise2Mix;\r\n\r\n\r\n/**\r\n * Drawing assumed to be from front to back stage (i.e. closest first):\r\n * (which allows to stop as soon as opacity is 100% or above some threshold like 99.5%)\r\n */\r\nvec4 composeFTB(vec4 current, vec4 layer) {\r\n  return current + (1.0 - current.a) * vec4(layer.rgb, 1) * layer.a;\r\n}\r\n\r\n/**\r\n * Drawing assumed to be from back to front stage (i.e. closest last):\r\n */\r\nvec4 composeBTF(vec4 current, vec4 layer) {\r\n  return mix(current, vec4(layer.rgb, 1.0), layer.a);\r\n}\r\n\r\n\r\n//  Simplex 3D Noise \r\n//  by Ian McEwan, Ashima Arts\r\n//\r\nvec4 permute_08(vec4 x) {\r\n    return mod(((x*34.0)+1.0)*x, 289.0);\r\n}\r\nvec4 taylorInvSqrt_08(vec4 r){\r\n    return 1.79284291400159 - 0.85373472095314 * r;\r\n}\r\nfloat simplex3DNoise(vec3 v){ \r\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\r\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\r\n\r\n  // First corner\r\n  vec3 i  = floor(v + dot(v, C.yyy) );\r\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\r\n\r\n  // Other corners\r\n  vec3 g = step(x0.yzx, x0.xyz);\r\n  vec3 l = 1.0 - g;\r\n  vec3 i1 = min( g.xyz, l.zxy );\r\n  vec3 i2 = max( g.xyz, l.zxy );\r\n\r\n  //  x0 = x0 - 0. + 0.0 * C \r\n  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\r\n  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\r\n  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\r\n\r\n  // Permutations\r\n  i = mod(i, 289.0 ); \r\n  vec4 p = permute_08( permute_08( permute_08( \r\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\r\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \r\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\r\n\r\n  // Gradients\r\n  // ( N*N points uniformly over a square, mapped onto an octahedron.)\r\n  float n_ = 1.0/7.0; // N=7\r\n  vec3  ns = n_ * D.wyz - D.xzx;\r\n\r\n  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\r\n\r\n  vec4 x_ = floor(j * ns.z);\r\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\r\n\r\n  vec4 x = x_ *ns.x + ns.yyyy;\r\n  vec4 y = y_ *ns.x + ns.yyyy;\r\n  vec4 h = 1.0 - abs(x) - abs(y);\r\n\r\n  vec4 b0 = vec4( x.xy, y.xy );\r\n  vec4 b1 = vec4( x.zw, y.zw );\r\n\r\n  vec4 s0 = floor(b0)*2.0 + 1.0;\r\n  vec4 s1 = floor(b1)*2.0 + 1.0;\r\n  vec4 sh = -step(h, vec4(0.0));\r\n\r\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\r\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\r\n\r\n  vec3 p0 = vec3(a0.xy,h.x);\r\n  vec3 p1 = vec3(a0.zw,h.y);\r\n  vec3 p2 = vec3(a1.xy,h.z);\r\n  vec3 p3 = vec3(a1.zw,h.w);\r\n\r\n  //Normalise gradients\r\n  vec4 norm = taylorInvSqrt_08(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\r\n  p0 *= norm.x;\r\n  p1 *= norm.y;\r\n  p2 *= norm.z;\r\n  p3 *= norm.w;\r\n\r\n  // Mix final noise value\r\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\r\n  m = m * m;\r\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \r\n                                dot(p2,x2), dot(p3,x3) ) );\r\n}\r\n\r\nfloat simplexFractal3DNoise(vec3 m) {\r\n\treturn   0.5333333 * simplex3DNoise(m)\r\n            +0.2666667 * simplex3DNoise(2.0*m)\r\n            +0.1333333 * simplex3DNoise(4.0*m)\r\n            +0.0666667 * simplex3DNoise(8.0*m);\r\n}\r\n\r\n// const matrices for 3d rotation\r\nconst mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\r\nconst mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\r\nconst mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\r\n\r\n// directional artifacts can be reduced by rotating each octave\r\nfloat simplexFractal3DNoise2(vec3 m) {\r\n    return 0.5333333*simplex3DNoise(m*rot1)\r\n      +0.2666667*simplex3DNoise(2.0*m*rot2)\r\n      +0.1333333*simplex3DNoise(4.0*m*rot3)\r\n      +0.0666667*simplex3DNoise(8.0*m);\r\n}\r\n\r\n\r\n// www.shadertoy.com/view/XsX3zB\r\n// by Nikita Miropolskiy\r\n\r\n// discontinuous pseudorandom uniformly distributed in [-0.5, +0.5]^3\r\nvec3 random3_10(vec3 c) {\r\n\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\r\n\tvec3 r;\r\n\tr.z = fract(512.0*j);\r\n\tj *= .125;\r\n\tr.x = fract(512.0*j);\r\n\tj *= .125;\r\n\tr.y = fract(512.0*j);\r\n\treturn r-0.5;\r\n}\r\n\r\n// skew constants for 3d simplex functions\r\nconst float F3_10 =  0.3333333;\r\nconst float G3_10 =  0.1666667;\r\nfloat simplex3DNoise_10(vec3 p) {\r\n\t // 1. find current tetrahedron T and it's four vertices\r\n\t // s, s+i1, s+i2, s+1.0 - absolute skewed (integer) coordinates of T vertices\r\n\t // x, x1, x2, x3 - unskewed coordinates of p relative to each of T vertices\r\n\t \r\n\t // calculate s and x\r\n\t vec3 s = floor(p + dot(p, vec3(F3_10)));\r\n\t vec3 x = p - s + dot(s, vec3(G3_10));\r\n\t \r\n\t // calculate i1 and i2\r\n\t vec3 e = step(vec3(0.0), x - x.yzx);\r\n\t vec3 i1 = e*(1.0 - e.zxy);\r\n\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\r\n\t \t\r\n\t // x1, x2, x3\r\n\t vec3 x1 = x - i1 + G3_10;\r\n\t vec3 x2 = x - i2 + 2.0*G3_10;\r\n\t vec3 x3 = x - 1.0 + 3.0*G3_10;\r\n\t \r\n\t // 2. find four surflets and store them in d\r\n\t vec4 w, d;\r\n\t \r\n\t // calculate surflet weights\r\n\t w.x = dot(x, x);\r\n\t w.y = dot(x1, x1);\r\n\t w.z = dot(x2, x2);\r\n\t w.w = dot(x3, x3);\r\n\t \r\n\t // w fades from 0.6 at the center of the surflet to 0.0 at the margin\r\n\t w = max(0.6 - w, 0.0);\r\n\t \r\n\t // calculate surflet components\r\n\t d.x = dot(random3_10(s), x);\r\n\t d.y = dot(random3_10(s + i1), x1);\r\n\t d.z = dot(random3_10(s + i2), x2);\r\n\t d.w = dot(random3_10(s + 1.0), x3);\r\n\t \r\n\t // multiply d by w^4\r\n\t w *= w;\r\n\t w *= w;\r\n\t d *= w;\r\n\t \r\n\t // 3. return the sum of the four surflets\r\n\t return dot(d, vec4(52.0));\r\n}\r\n\r\nfloat simplexFractal3DNoise_10(vec3 m) {\r\n\treturn   0.5333333 * simplex3DNoise_10(m)\r\n            +0.2666667 * simplex3DNoise_10(2.0*m)\r\n            +0.1333333 * simplex3DNoise_10(4.0*m)\r\n            +0.0666667 * simplex3DNoise_10(8.0*m);\r\n}\r\n\r\n// const matrices for 3d rotation\r\nconst mat3 rot1_10 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\r\nconst mat3 rot2_10 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\r\nconst mat3 rot3_10 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\r\n\r\n// directional artifacts can be reduced by rotating each octave\r\nfloat simplexFractal3DNoise2_10(vec3 m) {\r\n    return 0.5333333*simplex3DNoise_10(m*rot1_10)\r\n      +0.2666667*simplex3DNoise_10(2.0*m*rot2_10)\r\n      +0.1333333*simplex3DNoise_10(4.0*m*rot3_10)\r\n      +0.0666667*simplex3DNoise_10(8.0*m);\r\n}\r\n\r\n\r\n//   _   _  _____ ______  _____  _   _  _____  _____ \r\n//  | | | ||  _  || ___ |  _  ||  | ||  _  ||_   _|\r\n//  | | | || | | || |_/ /| | | ||  | || | | |  | |  \r\n//  | | | || | | ||    / | | | || . ' || | | |  | |  \r\n//   _/ / _/ /| |   _/ /| |  | _/ / _| |_ \r\n//   ___/  ___/ _| _| ___/ _| _/ ___/  ___/ \r\n//                                                   \r\n//                                                   \r\n\r\n// by inigo quilez http://iquilezles.org/www/articles/voronoise/voronoise.htm\r\n// https://www.shadertoy.com/view/Xd23Dh\r\n//\r\n\r\nvec3 hash3_11( vec2 p ){\r\n    vec3 q = vec3( dot(p,vec2(127.1,311.7)), \r\n\t\t\t\t   dot(p,vec2(269.5,183.3)), \r\n\t\t\t\t   dot(p,vec2(419.2,371.9)) );\r\n\treturn fract(sin(q)*43758.5453);\r\n}\r\n\r\nfloat voroNoise_iq( in vec2 x, float u, float v ){\r\n    vec2 p = floor(x);\r\n    vec2 f = fract(x);\r\n\t\t\r\n\tfloat k = 1.0+63.0*pow(1.0-v,4.0);\r\n\t\r\n\tfloat va = 0.0;\r\n\tfloat wt = 0.0;\r\n    for( int j=-2; j<=2; j++ )\r\n    for( int i=-2; i<=2; i++ )\r\n    {\r\n        vec2 g = vec2( float(i),float(j) );\r\n\t\tvec3 o = hash3_11( p + g )*vec3(u,u,1.0);\r\n\t\tvec2 r = g - f + o.xy;\r\n\t\tfloat d = dot(r,r);\r\n\t\tfloat ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\r\n\t\tva += o.z*ww;\r\n\t\twt += ww;\r\n    }\r\n\t\r\n    return va/wt;\r\n}\r\n\r\n//\thttps://www.shadertoy.com/view/lsjGWD\r\n//\tby Pietro De Nicola\r\n//\r\n// Use:\r\n// vec2 p = gl_FragCoord.xy/iResolution.xx;\r\n// float c = POWER*fbm( SCALE*p ) + BIAS;\r\n#define OCTAVES_12   \t\t1\t\t// 7\r\n#define SWITCH_TIME_12 \t5.0\t\t// seconds\r\n\r\nvec2 hash_12( vec2 p ){\r\n\tp = vec2( dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));\r\n\treturn fract(sin(p)*43758.5453);\r\n}\r\n\r\nfloat voronoi_12( in vec2 x, float type, float speed ){\r\n    // When calculating FBM noise, these first variables could be optimized\r\n    // as they are the same for each octave.\r\n    float function_12 \t\t\t= mod(type, 4.0);\r\n    bool  multiply_by_F1_12\t    = mod(type, 8.0)  >= 4.0;\r\n    bool  inverse_12\t\t\t= mod(type, 16.0) >= 8.0;\r\n    float distance_type_12\t    = mod(type/16.0, 4.0);\r\n\r\n\tvec2 n = floor( x );\r\n\tvec2 f = fract( x );\r\n\t\r\n\tfloat F1 = 8.0;\r\n\tfloat F2 = 8.0;\r\n\t\r\n\tfor( int j=-1; j<=1; j++ )\r\n\t\tfor( int i=-1; i<=1; i++ ){\r\n\t\t\tvec2 g = vec2(i,j);\r\n\t\t\tvec2 o = hash_12( n + g );\r\n\r\n\t\t\to = 0.5 + 0.41*sin(speed * iTime + 6.2831*o );\t\r\n\t\t\tvec2 r = g - f + o;\r\n\r\n\t\tfloat d = \tdistance_type_12 < 1.0 ? dot(r,r)  :\t\t\t\t// euclidean^2\r\n\t\t\t\t  \tdistance_type_12 < 2.0 ? sqrt(dot(r,r)) :\t\t\t// euclidean\r\n\t\t\t\t\tdistance_type_12 < 3.0 ? abs(r.x) + abs(r.y) :\t\t// manhattan\r\n\t\t\t\t\tdistance_type_12 < 4.0 ? max(abs(r.x), abs(r.y)) :\t// chebyshev\r\n\t\t\t\t\t0.0;\r\n\r\n\t\tif( d<F1 ) { \r\n\t\t\tF2 = F1; \r\n\t\t\tF1 = d; \r\n\t\t} else if( d<F2 ) {\r\n\t\t\tF2 = d;\r\n\t\t}\r\n    }\r\n\t\r\n\tfloat c = function_12 < 1.0 ? F1 : \r\n\t\t\t  function_12 < 2.0 ? F2 : \r\n\t\t\t  function_12 < 3.0 ? F2-F1 :\r\n\t\t\t  function_12 < 4.0 ? (F1+F2)/2.0 : \r\n\t\t\t  0.0;\r\n\t\t\r\n\tif( multiply_by_F1_12 )\tc *= F1;\r\n\tif( inverse_12 )\t\t\tc = 1.0 - c;\r\n\t\r\n    return c;\r\n}\r\n\r\nfloat voronoi_12( in vec2 x ){\r\n    float t = iTime/SWITCH_TIME_12;\r\n    return voronoi_12(x, t, 1.0);\r\n}\r\n\r\nfloat voronoiFBM_12( in vec2 p ){\r\n\tfloat s = 0.0;\r\n\tfloat m = 0.0;\r\n\tfloat a = 0.5;\r\n\t\r\n\tfor( int i=0; i<OCTAVES_12; i++ ){\r\n\t\ts += a * voronoi_12(p);\r\n\t\tm += a;\r\n\t\ta *= 0.5;\r\n\t\tp *= 2.0;\r\n\t}\r\n\treturn s/m;\r\n}\r\n\r\n// --- From http://www.madebyevan.com/shaders/fast-rounded-rectangle-shadows/\r\n// License: CC0 (http://creativecommons.org/publicdomain/zero/1.0/)\r\n/**\r\n * Faster way to draw box shadows and blurred rectangles.\r\n * Return the mask for the shadow of a box from lower to upper\r\n * sigma: size of the shadow, ~ in the given unit\r\n **/ \r\n// This approximates the error function, needed for the gaussian integral\r\nvec4 erf(vec4 x) {\r\n  vec4 s = sign(x), a = abs(x);\r\n  x = 1.0 + (0.278393 + (0.230389 + 0.078108 * (a * a)) * a) * a;\r\n  x *= x;\r\n  return s - s / (x * x);\r\n}\r\n// Return the mask for the shadow of a box from lower to upper\r\nfloat boxShadow(vec2 lower, vec2 upper, vec2 point, float sigma) {\r\n  // Nathan Vogel: Optimize by not calculating beyond the blur distance. \r\n  // 2.5 seems about correct, 2.3 might cut a tiny bit.\r\n  if (point.y < lower.y - sigma * 2.6) return 0.0;\r\n  if (point.y > upper.y + sigma * 2.6) return 0.0;\r\n  if (point.x < lower.x - sigma * 2.6) return 0.0;\r\n  if (point.x > upper.x + sigma * 2.6) return 0.0;\r\n  vec4 query = vec4(point - lower, point - upper);\r\n  vec4 integral = 0.5 + 0.5 * erf(query * (sqrt(0.5) / sigma));\r\n  return (integral.z - integral.x) * (integral.w - integral.y);\r\n}\r\n// --- End of: From madebyevan.com --------------------\r\n\r\n\r\nvec2 remapDither(vec2 v) {\r\n  return (mod(v, _DitherPattern_TexelSize)) / _DitherPattern_TexelSize;\r\n}\r\n\r\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\r\n{\r\n  vec2 coord = fragCoord;\r\n  vec2 baseP = 2.0 * (coord.xy - iResolution.xy) / scaledResolutionTarget.y;\r\n\r\n  vec4 color = vec4(1.0);\r\n\r\n  for (int i = 0; i < 20; i += 1) {\r\n    float height = DOM[i].y - DOM[i].w;\r\n    // Skip the ones without height (= not bound to a node.)\r\n    if (height == 0.0) { continue; }\r\n\r\n    // Attempt to calculate a resonnable blur\r\n    float blur = blurSize * 0.00008 *\r\n        max(scaledResolutionTarget.x, scaledResolutionTarget.y) * \r\n        min(height, scaledResolutionTarget.y / 2.0);\r\n    // Change the visual FX when its a draft.\r\n    bool draft = DOMColors[i].w >= 1.0;\r\n    if (draft) { blur = blur / 1.57; }\r\n\r\n    // Create a fast blurred rectangle (I remapped coordinates through trial and error).\r\n    // This box shadow blur also blurs inside the original rect, so we add some padding \r\n    // to account for it.\r\n    vec2 pad = vec2(blur * 0.5 * padSize);\r\n    float rect = boxShadow(DOM[i].xw - pad, DOM[i].zy + pad, coord, blur);\r\n    // Optimize by not calculating any noise etc. where it won't be seen.\r\n    if (rect < 3.0/256.0) { continue; }\r\n\r\n    vec2 p = baseP / (25.0 + blur) * 800.0;\r\n    vec2 noiseSpeed = -vec2(0.2, 0.7) * iTime;\r\n    float noise = voronoi_12(\r\n      noise1Scale * p * 0.25 + noise1Motion * 1.8 * noiseSpeed, \r\n      23.0, \r\n      noise1Speed * 2.0 * (draft ? 3.33 : 1.0)\r\n    ); \r\n    float noise2 = simplex3DNoise(vec3(\r\n      noise2Scale * p * 0.08 + noise2Motion * 0.5 * noiseSpeed, \r\n      noise2Speed * 0.3 * iTime * (draft ? 5.0 : 1.0)\r\n    ));\r\n    float mask = mix(noise * rect, rect, rect);\r\n    mask = mask * (1.0 - noise2Mix) + noise2Mix * mix(noise2 * mask, mask, rect);\r\n\r\n    // Compose all messages one after the other.\r\n    color = composeBTF(color, vec4(DOMColors[i].xyz, mask));\r\n  }\r\n\r\n  fragColor = color;\r\n}\r\n\r\nvoid main() {\r\n  mainImage(gl_FragColor, gl_FragCoord.xy);\r\n}\r\n      `,\r\n      \"NO_RENDER\",\r\n      Object.assign(\r\n        {\r\n          textures: [],\r\n          midiBindings: [],\r\n          additionalUniforms: this.controlledUniforms,\r\n        },\r\n        options\r\n      )\r\n    );\r\n\r\n    if (options.showDatGui) {\r\n      const uniforms = this.pen.uniforms;\r\n      const gui = new dat.GUI();\r\n      gui.add(uniforms.noise1Speed, \"value\", 0, 5).name(\"Noise 1 Speed\");\r\n      gui.add(uniforms.noise1Motion, \"value\", -5, 5).name(\"Noise 1 Motion\");\r\n      gui.add(uniforms.noise1Scale, \"value\", 0, 5).name(\"Noise 1 Scale\");\r\n      gui.add(uniforms.noise2Speed, \"value\", 0, 5).name(\"Noise 2 Speed\");\r\n      gui.add(uniforms.noise2Motion, \"value\", -5, 5).name(\"Noise 2 Motion\");\r\n      gui.add(uniforms.noise2Scale, \"value\", 0, 5).name(\"Noise 2 Scale\");\r\n      gui.add(uniforms.blurSize, \"value\", 0, 5).name(\"Blur Scale\");\r\n      gui.add(uniforms.padSize, \"value\", -2, 5).name(\"Pad Scale\");\r\n      gui.add(uniforms.noise2Mix, \"value\", -0, 1).name(\"Noise 2 Mix\");\r\n    }\r\n\r\n    this.pen.render();\r\n  }\r\n\r\n  setMessages = (messages: ImUsBackgroundMessage[]) => {\r\n    const bindings = messages.map((message) =>\r\n      Object.assign({ flags: message.draft ? 1 : 0 }, message)\r\n    );\r\n    this.pen.setDOMBindings(bindings);\r\n  };\r\n}\r\n\r\nexport default ImUsBackground;\r\n","import React, { useEffect } from \"react\";\nimport ImUsBackground from \"./ImUsBackground\";\nimport { ImUsBackgroundMessage } from \"./types\";\n\nfunction App() {\n  useEffect(() => {\n    const background = new ImUsBackground({\n      midiBindings: [\n        // [176, 48, { from: 0, to: 10, initial: 1.0 }],\n        // [176, 49, { from: 0, to: 10, initial: 1.0 }],\n        // [176, 50, { from: 0, to: 10, initial: 1.0 }],\n        // [176, 51, { from: 0, to: 10, initial: 1.0 }],\n        // [176, 52, { from: -2, to: 2, initial: 1.0 }],\n        // [176, 53, { from: -2, to: 2, initial: 1.0 }],\n        // [176, 54, { from: -2, to: 2, initial: 1.0 }],\n        // [176, 55, { from: -2, to: 2, initial: 1.0 }],\n      ],\n      midiLogs: false,\n      showDatGui: true,\n      maxDomNodeCount: 20,\n      canvas: document.getElementById(\"background\") as HTMLCanvasElement,\n    });\n\n    const messages: ImUsBackgroundMessage[] = [];\n    const elements = document.getElementsByClassName(\"message\");\n    for (let i = 0; i < elements.length; i += 1) {\n      messages.push({\n        element: elements[i],\n        color: [i / elements.length, Math.random(), Math.random()],\n        draft: elements[i].classList.contains(\"draft\"),\n      });\n    }\n    console.log(messages);\n    background.setMessages(messages);\n  }, []);\n\n  return (\n    <div id=\"ui\">\n      <div\n        contentEditable=\"true\"\n        suppressContentEditableWarning={true}\n        className=\"message big draft\"\n      >\n        Type here...\n      </div>\n      <div className=\"message big\">#StayHome</div>\n      <div className=\"message big\">This is not a drill.</div>\n      <div className=\"message big\">“Culture is technoculture.”</div>\n      <div className=\"message big\">\n        “Arguing that you don't care about the right to privacy because you have\n        nothing to hide is no different than saying you don't care about free\n        speech because you have nothing to say.”\n      </div>\n      <div className=\"message big\">Why are people still going outside?</div>\n      <div className=\"message\">The streets are empty...</div>\n      <div className=\"message\">Hi</div>\n      <div className=\"message\">The city is so quiet.</div>\n      <div className=\"message\">\n        “Real, total war has become information war. It is being fought by\n        subtle electric informational media- under cold conditions, and\n        constantly. The cold war is the real war front- a surround- involving\n        everybody- all the time- everywhere. Whenever hot wars are necessary\n        these days, we conduct them in the backyards of the world with the old\n        technologies. These wars are happenings, tragic games. It is no longer\n        convenient, or suitable, to use the latest technologies for fighting our\n        wars, because the latest technologies have rendered wars meaningless.\n        The hydrogen bomb is history’s exclamation point.”\n      </div>\n      <div className=\"message big\">\n        “I arise in the morning torn between a desire to improve (or save) the\n        world and a desire to enjoy (or savor) the world.”\n      </div>\n      <div className=\"message big\">I'm #StayingAtHome</div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}